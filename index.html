<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Social Media Marketing Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Google Identity Services (new) -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
<!-- gapi client (used for the YouTube Data client library) -->
<script src="https://apis.google.com/js/api.js" async defer></script>

<style>
body {font-family:'Roboto',sans-serif; margin:0; background:#f4f6f8; color:#333;}
header {background:#4267B2; color:#fff; padding:25px 20px; text-align:center; font-size:1.6em; font-weight:700; box-shadow:0 4px 8px rgba(0,0,0,0.1);}
.container {max-width:1200px; margin:20px auto; padding:0 20px;}
.card {background:#fff; border-radius:12px; padding:18px 22px; margin-bottom:20px; box-shadow:0 6px 20px rgba(0,0,0,0.06);}
.card h3 {margin-top:0; color:#444; margin-bottom:10px; font-size:1.05em;}
button {background:#4267B2; color:#fff; border:none; padding:8px 14px; margin:6px 0; border-radius:6px; cursor:pointer; font-weight:500;}
button:hover {background:#365899;}
textarea,input,select {width:100%; padding:10px; margin:6px 0; border-radius:6px; border:1px solid #ccc;}
pre {background:#f0f0f0; padding:12px; border-radius:8px; overflow-x:auto; max-height:260px;}
.status {font-weight:500; margin-bottom:10px;}
.chart-container {position:relative; height:300px; margin-top:15px;}
.section-color-1 {border-left:6px solid #4267B2;}
.section-color-2 {border-left:6px solid #f57c00;}
.section-color-3 {border-left:6px solid #6a1b9a;}
.section-color-4 {border-left:6px solid #00796b;}
.section-color-5 {border-left:6px solid #1DA1F2;}
.section-color-6 {border-left:6px solid #E1306C;}
.section-color-7 {border-left:6px solid #FF0000;}
@media(max-width:600px){header{font-size:1.3em;padding:18px};.card{padding:12px}}
.note {font-size:0.9em;color:#666;margin-top:6px;}
.error {color:#b00020;font-weight:600;}
</style>
</head>
<body>
<header>Social Media Marketing Dashboard</header>
<div class="container">

<!-- FACEBOOK -->
<div class="card section-color-1">
  <h3>üìò Facebook Login</h3>
  <p class="status" id="status">Not logged in.</p>
  <button id="btnLogin">Login with Facebook</button>
  <button id="btnLogout" style="display:none">Logout</button>
  <div class="note">Use this to list pages/ad-accounts and then fetch page/instagram insights.</div>
</div>

<!-- FACEBOOK ADS -->
<div class="card section-color-2">
  <h3>üíº Facebook Ad Accounts & Insights</h3>
  <div id="adAccountsList">Not loaded</div>
  <div id="selectedAdAccount" style="margin:8px 0"></div>
  <button id="btnGetAdInsights">Fetch Ad Insights (last 7 days)</button>
  <pre id="adInsightsResult"></pre>
  <div class="chart-container"><canvas id="adChart"></canvas></div>
</div>

<!-- FACEBOOK PAGES -->
<div class="card section-color-3">
  <h3>üìÉ Facebook Pages</h3>
  <div id="pagesList">Not loaded</div>
</div>

<!-- PAGE ACTIONS -->
<div class="card section-color-4">
  <h3>‚öôÔ∏è Page Actions & Page Insights</h3>
  <div><b>Selected Page:</b> <span id="selectedPageName"></span></div>
  <textarea id="postMessage" placeholder="Post message">Hello from dashboard!</textarea>
  <button id="btnPost">Post to Page</button>
  <pre id="postResult"></pre>
  <select id="insightsMetric">
    <option value="page_fans">Fans</option>
    <option value="page_impressions">Impressions</option>
    <option value="page_engaged_users">Engaged Users</option>
  </select>
  <button id="btnGetPageInsights">Fetch Page Insights (7d)</button>
  <div class="chart-container"><canvas id="pageChart"></canvas></div>
</div>

<!-- INSTAGRAM -->
<div class="card section-color-6">
  <h3>üì∏ Instagram (via connected Page)</h3>
  <button id="btnGetInstagramInfo">Fetch Instagram Info</button>
  <pre id="instaInfo"></pre>
  <input id="instaImageUrl" placeholder="Image URL (for posting)">
  <textarea id="instaCaption" placeholder="Caption">Hello from dashboard!</textarea>
  <button id="btnInstaPost">Create Instagram Media + Publish</button>
  <pre id="instaPostResult"></pre>
  <button id="btnGetInstaInsights">Fetch IG Insights (7d)</button>
  <div class="chart-container"><canvas id="instaChart"></canvas></div>
  <div class="note">Instagram features require the Facebook Page to be linked to an Instagram Business account and the app to have approved permissions.</div>
</div>

<div class="card section-color-1">
  <h3>üí¨ WhatsApp Business API</h3>
  <button id="btnGetWhatsAppInfo">Fetch WhatsApp Info</button>
  <pre id="waInfo"></pre>

  <textarea id="waMessage" placeholder="Enter message to send"></textarea>
  <input id="waPhone" placeholder="Recipient phone in E.164 (e.g. +919876543210)" />
  <button id="btnSendWA">Send WhatsApp Message</button>
  <pre id="waResult"></pre>
</div>


<!-- TWITTER -->
<div class="card section-color-5">
  <h3>üê¶ Twitter (via backend proxy)</h3>
  <div class="note">
    Backend proxy: <b>https://social-ads-backend.onrender.com</b><br>
    Use this to safely post tweets and fetch analytics.
  </div>

  <input id="twitterUsername" placeholder="Enter username (e.g. Kathirludus2710)" />
  <button id="btnGetTwitterProfile">Get Profile Info</button>
  <pre id="twitterProfile"></pre>

  <textarea id="tweetContent" placeholder="Write your tweet...">üöÄ Hello world from my Social Ads Dashboard!</textarea>
  <button id="btnPostTweet">Post Tweet / Ad</button>
  <pre id="tweetResult"></pre>

  <input id="tweetIdInput" placeholder="Enter Tweet ID for metrics" />
  <button id="btnGetTweetMetrics">Get Tweet Metrics</button>
  <div class="chart-container"><canvas id="twitterChart"></canvas></div>

  <button id="btnGetAccountMetrics">Get Account Metrics</button>
  <pre id="twitterAccountMetrics"></pre>
</div>
<!-- YOUTUBE -->
<div class="card section-color-7">
  <h1>üìä YouTube Ads Upload & Analytics</h1>

  <div class="controls">
    <button id="btnGoogleLogin">Login with Google</button>
    <button id="btnGoogleLogout" style="display:none;">Logout</button>
    <span id="ytStatus">Not logged in</span>
  </div>

  <hr>

  <div>
    <button id="btnGetChannelInfo">Get Channel Info</button>
    <button id="btnGetYTAnalytics">View Analytics</button>
    <button id="btnGetAdVideoMetrics">Get Ad Video Metrics</button>
    <pre id="ytInfo"></pre>
    <pre id="ytMetrics"></pre>
  </div>

  <hr>

  <h3>üé• Upload Your Ad / Video</h3>
  <form id="uploadForm">
    <input type="text" id="title" placeholder="Video Title" required /><br>
    <textarea id="description" placeholder="Description"></textarea><br>
    <select id="privacy">
      <option value="public">Public</option>
      <option value="unlisted">Unlisted</option>
      <option value="private" selected>Private</option>
    </select><br>
    <input type="file" id="videoFile" accept="video/*" required /><br>
    <button type="submit">Upload Video</button>
  </form>
  <pre id="ytUploadResult"></pre>

  <canvas id="ytChart" width="400" height="200"></canvas>
</div>


<div class="card section-color-?" id="snapchatSection">
  <h3>üëª Snapchat Campaign Metrics</h3>
  <input id="scAccountId" placeholder="Ad Account ID">
  <input id="scCampaignId" placeholder="Campaign ID">
  <input id="scStart" placeholder="Start Date (YYYY-MM-DD)">
  <input id="scEnd" placeholder="End Date (YYYY-MM-DD)">
  <input id="scBreakdowns" placeholder="Breakdowns (comma, e.g., age_range,region)">
  <button id="btnGetSnapchatMetrics">Fetch Snapchat Metrics</button>
  <pre id="scResult"></pre>
  <div class="chart-container"><canvas id="scChart"></canvas></div>
</div>


</div>

<!-- Facebook SDK -->
<script src="https://connect.facebook.net/en_US/sdk.js"></script>

<script>
/* ---------------------------
   Configuration - REPLACE
   ---------------------------
   Put your real values here before deploying.
   - FB_APP_ID: facebook app id (web)
   - GOOGLE_CLIENT_ID: google web oauth client id
   NOTE: For Twitter, do NOT put bearer token in frontend in production.
*/

const FB_APP_ID = '2766175383577129'; // <-- replace with your FB App ID
const GOOGLE_CLIENT_ID = '909323253369-817lthmrt17refrp225q39h4nkqsp2tj.apps.googleusercontent.com'; // <-- replace with your Google Web client ID

/* ---------------------------
   Globals
   --------------------------- */
const FB_SCOPES = 'public_profile,pages_show_list,pages_manage_posts,pages_read_engagement,ads_read,ads_management,business_management,instagram_basic,instagram_manage_insights,instagram_content_publish';
let userAccessToken=null, pages=[], selectedPage=null, adAccounts=[], selectedAdAccount=null;
let pageChart=null, instaChart=null, twitterChart=null, ytChart=null, adChart=null;

/* ---------------------------
   FACEBOOK: init + helpers
   --------------------------- */
window.fbAsyncInit = function() {
  FB.init({ appId: FB_APP_ID, cookie: true, xfbml: false, version: 'v19.0' });
  FB.getLoginStatus(checkLoginState);
};

function checkLoginState(response) {
  if (response && response.status === 'connected') {
    userAccessToken = response.authResponse.accessToken;
    document.getElementById('btnLogin').style.display='none';
    document.getElementById('btnLogout').style.display='inline-block';
    document.getElementById('status').textContent = '‚úÖ Logged in (Facebook)';
    fetchAdAccounts();
    fetchPages();
  } else {
    document.getElementById('status').textContent = 'Not logged in.';
  }
}

document.getElementById('btnLogin').onclick = () => {
  FB.login(checkLoginState, { scope: FB_SCOPES });
};
document.getElementById('btnLogout').onclick = () => {
  FB.logout(()=> location.reload());
};

// fetch ad accounts
function fetchAdAccounts(){
  document.getElementById('adAccountsList').textContent = 'Loading...';
  FB.api('/me/adaccounts','GET',{access_token:userAccessToken}, r => {
    if (!r || r.error) {
      document.getElementById('adAccountsList').textContent = 'Failed to load ad accounts.';
      console.error('AdAccounts error', r);
      return;
    }
    adAccounts = r.data || [];
    if(!adAccounts.length) {
      document.getElementById('adAccountsList').textContent = 'No Ad Accounts found.';
      return;
    }
    document.getElementById('adAccountsList').innerHTML = adAccounts.map((a,i)=>{
      return `<strong>${a.name || a.account_id}</strong> (ID: ${a.account_id || a.id}) <button onclick="selectAdAccount(${i})">Select</button><br>`;
    }).join('');
  });
}
window.selectAdAccount = (i) => {
  selectedAdAccount = adAccounts[i];
  document.getElementById('selectedAdAccount').innerText = `Selected Ad Account: ${selectedAdAccount.name || selectedAdAccount.account_id}`;
};

// ad insights
document.getElementById('btnGetAdInsights').onclick = () => {
  if(!selectedAdAccount) return alert('Select an ad account first');
  const datePreset='last_7d';
  const fields='spend,impressions,clicks';
  FB.api(`/${selectedAdAccount.id}/insights`,'GET',{fields,date_preset:datePreset,access_token:userAccessToken}, res => {
    if(!res || res.error) {
      document.getElementById('adInsightsResult').textContent = 'Failed to load ad insights.';
      console.error('AdInsights error', res);
      return;
    }
    if(res.data && res.data.length) {
      const d = res.data[0];
      document.getElementById('adInsightsResult').textContent = JSON.stringify(d, null, 2);
      const metrics = { Spend: d.spend || 0, Impressions: d.impressions || 0, Clicks: d.clicks || 0 };
      if(adChart) adChart.destroy();
      adChart = new Chart(document.getElementById('adChart'), { type:'bar', data:{ labels:Object.keys(metrics), datasets:[{ data:Object.values(metrics), backgroundColor:'#f57c00' }]}});
    } else {
      document.getElementById('adInsightsResult').textContent = 'No insights returned.';
    }
  });
};

// fetch pages
function fetchPages(){
  document.getElementById('pagesList').textContent = 'Loading...';
  FB.api('/me/accounts','GET',{access_token:userAccessToken}, r => {
    if(!r || r.error) {
      document.getElementById('pagesList').textContent = 'Failed to load pages.';
      console.error('Pages error', r);
      return;
    }
    pages = r.data || [];
    if(!pages.length) {
      document.getElementById('pagesList').textContent = 'No Pages found.';
      return;
    }
    document.getElementById('pagesList').innerHTML = pages.map((p,i)=>`<strong>${p.name}</strong> <button onclick="selectPage(${i})">Select</button><br>`).join('');
  });
}
window.selectPage = (i) => {
  selectedPage = pages[i];
  document.getElementById('selectedPageName').textContent = selectedPage.name;
};

// post to page
document.getElementById('btnPost').onclick = () => {
  if(!selectedPage) return alert('Select a page first');
  const msg = document.getElementById('postMessage').value || '';
  fetch(`https://graph.facebook.com/v19.0/${selectedPage.id}/feed`, {
    method:'POST',
    body: new URLSearchParams({ message: msg, access_token: selectedPage.access_token })
  }).then(r=>r.json()).then(d => {
    document.getElementById('postResult').textContent = JSON.stringify(d, null, 2);
  }).catch(e=>{
    console.error(e);
    document.getElementById('postResult').textContent = 'Post failed. See console.';
  });
};

// page insights
document.getElementById('btnGetPageInsights').onclick = () => {
  if(!selectedPage) return alert('Select page first');
  const metric = document.getElementById('insightsMetric').value;
  FB.api(`/${selectedPage.id}/insights`, { metric, period:'days_7', access_token: selectedPage.access_token }, r => {
    if(!r || r.error) { document.getElementById('postResult').textContent='Failed to fetch insights'; console.error(r); return; }
    if(r.data && r.data[0]) {
      const labels = r.data[0].values.map(v=>v.end_time.split('T')[0]);
      const values = r.data[0].values.map(v=>v.value);
      if(pageChart) pageChart.destroy();
      pageChart = new Chart(document.getElementById('pageChart'), { type:'line', data:{ labels, datasets:[{ label: metric, data: values, borderColor:'#4267B2', fill:true, backgroundColor:'rgba(66,103,178,0.18)'}] }});
    } else {
      document.getElementById('postResult').textContent = 'No insights returned.';
    }
  });
};


/* ---------------------------
   INSTAGRAM (via connected page)
   --------------------------- */
document.getElementById('btnGetInstagramInfo').onclick = () => {
  if(!selectedPage) return alert('Select page first');
  FB.api(`/${selectedPage.id}?fields=instagram_business_account`, { access_token: selectedPage.access_token }, r => {
    if(!r || r.error) { document.getElementById('instaInfo').textContent='Error fetching IG account'; console.error(r); return; }
    if(!r.instagram_business_account) { document.getElementById('instaInfo').textContent='No IG account linked to this page.'; return; }
    const igId = r.instagram_business_account.id;
    FB.api(`/${igId}?fields=username,followers_count,media_count,profile_picture_url`, { access_token: selectedPage.access_token }, res => {
      document.getElementById('instaInfo').textContent = JSON.stringify(res, null, 2);
    });
  });
};

// create IG media then publish
document.getElementById('btnInstaPost').onclick = () => {
  if(!selectedPage) return alert('Select page first');
  const img = document.getElementById('instaImageUrl').value.trim();
  const caption = document.getElementById('instaCaption').value || '';
  if(!img) return alert('Provide an image URL for IG post.');
  FB.api(`/${selectedPage.id}?fields=instagram_business_account`, { access_token: selectedPage.access_token }, r => {
    if(!r || !r.instagram_business_account) return alert('No IG linked');
    const igId = r.instagram_business_account.id;
    // create media
    fetch(`https://graph.facebook.com/v19.0/${igId}/media`, {
      method:'POST',
      body: new URLSearchParams({ image_url: img, caption, access_token: selectedPage.access_token })
    }).then(r=>r.json()).then(d => {
      if(d.error) { document.getElementById('instaPostResult').textContent = JSON.stringify(d,null,2); return; }
      // publish
      fetch(`https://graph.facebook.com/v19.0/${igId}/media_publish`, {
        method:'POST',
        body: new URLSearchParams({ creation_id: d.id, access_token: selectedPage.access_token })
      }).then(rr=>rr.json()).then(pub => document.getElementById('instaPostResult').textContent = JSON.stringify(pub,null,2)).catch(e=>{console.error(e); document.getElementById('instaPostResult').textContent='Publish failed';});
    }).catch(e=>{console.error(e); document.getElementById('instaPostResult').textContent='Create media failed';});
  });
};

// Instagram Account Insights (Fixed)
document.getElementById('btnGetInstaInsights').onclick = () => {
  if (!selectedPage) return alert('Select page first');

  FB.api(`/${selectedPage.id}?fields=instagram_business_account`, 
    { access_token: selectedPage.access_token }, 
    r => {
      if (!r || !r.instagram_business_account) {
        alert('No Instagram business account linked to this page.');
        return;
      }

      const igId = r.instagram_business_account.id;

      // ‚úÖ Use only valid metrics for IG User Insights
      // Docs: https://developers.facebook.com/docs/instagram-api/reference/ig-user/insights
      const metrics = 'impressions,reach,profile_views';
      const period = 'days_28'; // ‚úÖ allowed values: day, week, days_28, month, lifetime

      FB.api(
        `/${igId}/insights?metric=${metrics}&period=${period}`,
        { access_token: selectedPage.access_token },
        res => {
          if (!res || res.error) {
            console.error('Insights error:', res);
            document.getElementById('instaInfo').textContent = `Error: ${res.error.message}`;
            return;
          }

          // Display chart
          if (res.data && res.data.length > 0) {
            const labels = res.data.map(i => i.name);
            const values = res.data.map(i => i.values[0].value);

            if (instaChart) instaChart.destroy();
            instaChart = new Chart(document.getElementById('instaChart'), {
              type: 'bar',
              data: {
                labels,
                datasets: [
                  {
                    data: values,
                    backgroundColor: '#E1306C',
                    borderWidth: 1,
                  },
                ],
              },
              options: {
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true } },
              },
            });

            document.getElementById('instaInfo').textContent = JSON.stringify(res.data, null, 2);
          } else {
            document.getElementById('instaInfo').textContent = 'No insights data returned.';
          }
        }
      );
    }
  );
};


// WhatsApp Section
document.getElementById('btnGetWhatsAppInfo').onclick = () => {
  FB.api('/me?fields=whatsapp_business_accounts', { access_token: userAccessToken }, res => {
    if (!res || res.error) {
      document.getElementById('waInfo').textContent = 'Error fetching WhatsApp accounts.';
      console.error(res);
      return;
    }
    document.getElementById('waInfo').textContent = JSON.stringify(res, null, 2);
  });
};

document.getElementById('btnSendWA').onclick = async () => {
  const msg = document.getElementById('waMessage').value;
  const phone = document.getElementById('waPhone').value;
  if (!msg || !phone) return alert('Enter both phone and message');

  const waBusinessId = "<YOUR_WHATSAPP_BUSINESS_ID>"; // Replace with your verified ID
  const token = userAccessToken;

  const res = await fetch(`https://graph.facebook.com/v19.0/${waBusinessId}/messages`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      messaging_product: 'whatsapp',
      to: phone,
      type: 'text',
      text: { body: msg }
    })
  });

  const data = await res.json();
  document.getElementById('waResult').textContent = JSON.stringify(data, null, 2);
};



const BACKEND_URL = "https://social-ads-backend.onrender.com";

/* ===========================================================
//    üê¶ TWITTER SECTION
// =========================================================== */
// async function callTwitterViaProxy(endpoint, method = 'GET', body = null) {
//   const url = `${BACKEND_URL}/twitter/${endpoint}`;
//   const options = { method, headers: { 'Content-Type': 'application/json' } };
//   if (body) options.body = JSON.stringify(body);
//   const res = await fetch(url, options);
//   return await res.json();
// }

// // Get Twitter Profile
// document.getElementById('btnGetTwitterProfile').onclick = async () => {
//   const username = document.getElementById('twitterUsername').value.trim();
//   if (!username) return alert('Enter username');

//   try {
//     const data = await callTwitterViaProxy(
//       `users/by/username/${username}?user.fields=public_metrics,profile_image_url`
//     );
//     document.getElementById('twitterProfile').textContent = JSON.stringify(data, null, 2);
//   } catch (err) {
//     console.error(err);
//     document.getElementById('twitterProfile').textContent = 'Error fetching Twitter profile.';
//   }
// };

// // Post Tweet
// document.getElementById('btnPostTweet').onclick = async () => {
//   const text = document.getElementById('tweetContent').value.trim();
//   if (!text) return alert('Enter tweet text');
//   try {
//     const result = await callTwitterViaProxy(`tweets`, 'POST', { text });
//     document.getElementById('tweetResult').textContent = JSON.stringify(result, null, 2);
//   } catch (err) {
//     console.error(err);
//     document.getElementById('tweetResult').textContent = 'Error posting tweet.';
//   }
// };

// // Get Tweet Metrics
// document.getElementById('btnGetTweetMetrics').onclick = async () => {
//   const id = document.getElementById('tweetIdInput').value.trim();
//   if (!id) return alert('Enter Tweet ID');
//   try {
//     const data = await callTwitterViaProxy(`tweets/${id}?tweet.fields=public_metrics`);
//     document.getElementById('tweetResult').textContent = JSON.stringify(data, null, 2);
//     if (data?.data?.public_metrics) {
//       const m = data.data.public_metrics;
//       if (twitterChart) twitterChart.destroy();
//       twitterChart = new Chart(document.getElementById('twitterChart'), {
//         type: 'bar',
//         data: {
//           labels: Object.keys(m),
//           datasets: [
//             { data: Object.values(m), backgroundColor: '#1DA1F2' }
//           ]
//         }
//       });
//     }
//   } catch (err) {
//     console.error(err);
//     document.getElementById('tweetResult').textContent = 'Error fetching metrics.';
//   }
// };
// 
const YT_GOOGLE_CLIENT_ID = "909323253369-817lthmrt17refrp225q39h4nkqsp2tj.apps.googleusercontent.com";
const YT_API_KEY = "AIzaSyDRV6_ZEnQMdcMIhbhDYJP9OSayla3AV48";  // your Google API key
let ytAccessToken = null;
let ytTokenClient = null;


// Init GAPI client
function gapiInit() {
  gapi.load("client", () => {
    gapi.client.setApiKey(YT_API_KEY);
    gapi.client.load("youtube", "v3").then(() => {
      console.log("YouTube Data API loaded");
    });
  });
}

// Setup OAuth on window load
window.addEventListener("load", () => {
  gapiInit();
  ytTokenClient = google.accounts.oauth2.initTokenClient({
    client_id: YT_GOOGLE_CLIENT_ID,
    scope: "https://www.googleapis.com/auth/youtube.upload https://www.googleapis.com/auth/youtube.readonly https://www.googleapis.com/auth/yt-analytics.readonly",
    callback: (resp) => {
      if (resp.error) {
        alert("Google token error: " + resp.error);
        return;
      }
      ytAccessToken = resp.access_token;
      document.getElementById("ytStatus").textContent = "‚úÖ Logged in (Google)";
      document.getElementById("btnGoogleLogin").style.display = "none";
      document.getElementById("btnGoogleLogout").style.display = "inline-block";
    },
  });
});

document.getElementById("btnGoogleLogin").onclick = () => {
  if (!ytTokenClient) return alert("Try again later.");
  ytTokenClient.requestAccessToken({ prompt: "consent" });
};

document.getElementById("btnGoogleLogout").onclick = () => {
  ytAccessToken = null;
  document.getElementById("ytStatus").textContent = "Logged out.";
  document.getElementById("btnGoogleLogin").style.display = "inline-block";
  document.getElementById("btnGoogleLogout").style.display = "none";
};

// Channel Info
document.getElementById("btnGetChannelInfo").onclick = async () => {
  if (!ytAccessToken) return alert("Login first.");
  gapi.client.setToken({ access_token: ytAccessToken });
  const res = await gapi.client.youtube.channels.list({
    mine: true,
    part: "snippet,statistics"
  });
  document.getElementById("ytInfo").textContent = JSON.stringify(res.result, null, 2);
};

// Analytics
document.getElementById("btnGetYTAnalytics").onclick = async () => {
  if (!ytAccessToken) return alert("Login first.");
  gapi.client.setToken({ access_token: ytAccessToken });
  const res = await gapi.client.youtube.channels.list({
    mine: true,
    part: "statistics"
  });
  const s = res.result.items[0].statistics;
  if (ytChart) ytChart.destroy();
  ytChart = new Chart(document.getElementById("ytChart"), {
    type: "bar",
    data: {
      labels: Object.keys(s),
      datasets: [{
        data: Object.values(s),
        backgroundColor: "#ff0000"
      }]
    },
    options: { plugins: { legend: { display: false } } }
  });
};

// Ad Video Metrics (via Analytics API)
document.getElementById("btnGetAdVideoMetrics").onclick = async () => {
  if (!ytAccessToken) return alert("Login first.");
  const videoId = prompt("Enter the YouTube Video ID for your ad:");
  if (!videoId) return;
  const startDate = prompt("Enter start date (YYYY-MM-DD):", "2025-01-01");
  const endDate = prompt("Enter end date (YYYY-MM-DD):", new Date().toISOString().split('T')[0]);

  // Use Analytics API v2 endpoint
  const url = `https://youtubeanalytics.googleapis.com/v2/reports?`
    + `ids=channel==MINE&startDate=${startDate}&endDate=${endDate}`
    + `&metrics=views,estimatedMinutesWatched,averageViewDuration`
    + `&dimensions=day`
    + `&filters=video==${videoId}`;

  const res = await fetch(url, {
    method: "GET",
    headers: {
      "Authorization": `Bearer ${ytAccessToken}`,
      "Accept": "application/json"
    }
  });
  const data = await res.json();
  document.getElementById("ytMetrics").textContent = JSON.stringify(data, null, 2);

  if (data.rows && data.rows.length) {
    const labels = data.rows.map(r => r[0]);
    const values = data.rows.map(r => r[1]);
    if (ytChart) ytChart.destroy();
    ytChart = new Chart(document.getElementById("ytChart"), {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "Views",
          data: values,
          borderColor: "#ff0000",
          fill: false
        }]
      }
    });
  }
};

// Upload Video
document.getElementById("uploadForm").onsubmit = async (e) => {
  e.preventDefault();
  if (!ytAccessToken) return alert("Login first.");
  const file = document.getElementById("videoFile").files[0];
  if (!file) return alert("Select a video.");

  const formData = new FormData();
  formData.append("video", file);
  formData.append("title", document.getElementById("title").value);
  formData.append("description", document.getElementById("description").value);
  formData.append("privacyStatus", document.getElementById("privacy").value);

  document.getElementById("ytUploadResult").textContent = "‚è≥ Uploading...";

  const res = await fetch("https://social-ads-backend.onrender.com/upload-video", {
    method: "POST",
    headers: { Authorization: `Bearer ${ytAccessToken}` },
    body: formData,
  });

  const data = await res.json();
  document.getElementById("ytUploadResult").textContent = JSON.stringify(data, null, 2);
};
// let scChart = null;

// document.getElementById('btnGetSnapchatMetrics').onclick = async () => {
//   const accountId = document.getElementById('scAccountId').value.trim();
//   const campaignId = document.getElementById('scCampaignId').value.trim();
//   const start = document.getElementById('scStart').value.trim();
//   const end = document.getElementById('scEnd').value.trim();
//   const breakdowns = document.getElementById('scBreakdowns').value.trim();

//   if (!accountId || !campaignId || !start || !end) return alert('Enter all fields');

//   const url = `/api/snapchat/metrics?accountId=${accountId}&campaignId=${campaignId}&startTime=${start}&endTime=${end}&breakdowns=${encodeURIComponent(breakdowns)}`;

//   try {
//     const res = await fetch(url);
//     const json = await res.json();
//     document.getElementById('scResult').textContent = JSON.stringify(json, null, 2);

//     if (json.success && json.data && json.data.timeseries_stats) {
//       const series = json.data.timeseries_stats[0].timeseries;
//       const labels = series.map(x => x.start_time.split('T')[0]);
//       const impressions = series.map(x => x.stats.impressions || 0);
//       const swipes = series.map(x => x.stats.swipes || 0);
//       // you can add more metrics here
//       if (scChart) scChart.destroy();
//       scChart = new Chart(document.getElementById('scChart'), {
//         type: 'line',
//         data: {
//           labels,
//           datasets: [
//             { label: 'Impressions', data: impressions, borderColor: '#FFFC00', fill:false },
//             { label: 'Swipes', data: swipes, borderColor: '#FF9F1C', fill:false }
//           ]
//         }
//       });
//     }

//   } catch (err) {
//     console.error(err);
//     document.getElementById('scResult').textContent = 'Error fetching Snapchat metrics';
//   }
// };

/* ---------------------------
   Helpful UI tips on first load
   --------------------------- */
(function setDefaults(){
  document.getElementById('twitterUsername').value = 'Kathirludus2710';
})();
</script>
</body>
</html>

